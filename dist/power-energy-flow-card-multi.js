!function(){"use strict";var e;class t{processConfig(t){t||(t={});let i={title:t.title?t.title:"PEFCM Card",power_or_energy:"power",devices:[],maxX:0,maxY:0,width:400,height:300,circle_radius:t.circle_radius?t.circle_radius:40,debug:!!t.debug&&t.debug,display:{}};if(this.validateUnknownKeys(t,e.cardKeys,"Unknown key in card config: "),!t.devices||0==t.devices.length)throw new Error("No devices defined");for(const e of t.devices)i.devices.push(this.validateDevice(e));this.validateReferences(i);for(const e in t)e.startsWith("display")&&(i.display[e]=this.validateDisplay(t[e],e));return i}makeStringArray(e,t){if(!e)return[];if("string"==typeof e)return[e];if("[object Array]"!=Object.prototype.toString.call(e))throw new Error("Expected an array of strings");for(const i of e)if("string"!=typeof i)throw new Error(t+" should be an array of strings");return e}validateUnknownKeys(e,t,i){for(const s in e)if(-1==t.indexOf(s))throw new Error(i+s)}validateReferences(e){const t=new Set;for(const i of e.devices)t.add(i.id);for(const i of e.devices)for(const e of i.connections)if(!t.has(e.target))throw new Error(`Connection target "${e.target}" doesn't exist`)}validateDisplay(e,t){if(!e)throw new Error("Empty display definition");if(this.validateUnknownKeys(e,["color","size","circle_radius","hidden"],`Unknown key in display config ${t}: `),"circle_radius"in e&&"display"!=t&&!t.startsWith("display-circle"))throw new Error("circle_radius can only be set in display or display-circle");return{color:e.color?e.color:"black",size:e.size?e.size:1,circle_radius:e.circle_radius?e.circle_radius:-1,hidden:!!e.hidden&&e.hidden}}validateDevice(t){if(!t)throw new Error("Empty device definition");if(!t.id)throw new Error("Device must have an id");if(!("xPos"in t))throw new Error("Device needs an xPos");if(!("yPos"in t))throw new Error("Device needs a yPos");this.validateUnknownKeys(t,e.deviceKeys,"Unknown key in device: ");let i={name:t.name?t.name:t.id,id:t.id,icon:t.icon?t.icon:"",power_sink:this.makeStringArray(t.power_sink,"Power sink"),power_source:this.makeStringArray(t.power_source,"Power source"),energy_sink:this.makeStringArray(t.energy_sink,"Energy sink"),energy_source:this.makeStringArray(t.energy_source,"Energy source"),xPos:t.xPos,yPos:t.yPos,type:"grid",floor:t.floor?t.floor:0,connections:[],max_power:t.max_power?t.max_power:20,percent_entity:t.percent_entity?t.percent_entity:void 0,display:{}};if(i.power_sink.length+i.power_source.length+i.energy_sink.length+i.energy_source.length==0)throw new Error("Need to define at least one of power_sink power_source energy_sink or energy_source");if(t.connections)for(const e of t.connections)i.connections.push(this.validateConnection(e));for(const e in t)e.startsWith("display")&&(i.display[e]=this.validateDisplay(t[e],e));return i}validateConnection(t){if(this.validateUnknownKeys(t,e.connectionKeys,"Unknown key in connection: "),!t)throw new Error("Empty connection definition");if(!t.desc)throw new Error("Connection need to have a description of its route");if(!t.target)throw new Error("Connection need to have a target");return{desc:`${t.desc}`,target:t.target,color:t.color?t.color:"black",mode:t.mode,entity:t.entity?t.entity:void 0,internal:!!t.internal&&t.internal}}}e=t,t.displaySuffixes=["","-circle","-icon","-text"],t.displaySuffixSuffixes=["","-active","-source","-sink","-inactive"],t.displayKeys=e.displaySuffixes.map(t=>e.displaySuffixSuffixes.map(e=>"display"+t+e)).reduce((e,t)=>e.concat(t),[]),t.cardKeys=["title","devices","circle_radius","type","debug","grid_options",...e.displayKeys],t.deviceKeys=["xPos","yPos","id","name","energy_sink","energy_source","power_source","power_sink","max_power","connections","icon","percent_entity","floor",...e.displayKeys],t.connectionKeys=["desc","target","color","mode","entity","internal"];class i{constructor(e,t=!1){this._connections=[],this._deviceIdMap=new Map,this._deviceNetFlow=new Map,this._debug=!1,this._devices=e,this._debug=t}reset(){this._connections=[],this._deviceIdMap=new Map,this._deviceNetFlow=new Map;for(const e of this._devices){this._deviceIdMap.set(e.id,e),this._deviceNetFlow.set(e.id,0);for(const t of e.connections)this._connections.push({c:t,fromDevice:e,value:null})}}get unassignedConnections(){return this._connections.filter(e=>null==e.value)}deviceConnections(e){return this._connections.filter(t=>t.fromDevice.id==e.id||t.c.target==e.id)}deviceUnassignedConnections(e){return this.deviceConnections(e).filter(e=>null==e.value)}get singletonDevices(){let e=[];for(const t of this._devices)1==this.deviceUnassignedConnections(t).length&&e.push(t);return e}setConnectionValue(e,t){if(null!==e.value)throw new Error(`Connection from ${e.fromDevice.id} to ${e.c.target} already has value assigned`);if(e.value=t,!e.c.internal){const i=this._deviceNetFlow.get(e.fromDevice.id);this._deviceNetFlow.set(e.fromDevice.id,i+t)}const i=this._deviceIdMap.get(e.c.target),s=this._deviceNetFlow.get(i.id);this._deviceNetFlow.set(i.id,s-t)}assignSingletonDevices(e){var t;let i=0;for(const s of this.singletonDevices){const n=this.deviceUnassignedConnections(s);if(1!=n.length)continue;const o=n[0],r=(o.fromDevice.id==s.id?1:-1)*(s.power_or_energy(e)-this._deviceNetFlow.get(s.id));this._debug&&(console.log(s.id,"is a singleton. Connection from",o.fromDevice.id,"to",o.c.target,"Device value",s.power_or_energy(e)," existing flow",this._deviceNetFlow.get(s.id)," setting flow to",r),console.log("Device expected power/energy is",o.fromDevice.power_or_energy(e),null===(t=this._deviceIdMap.get(o.c.target))||void 0===t?void 0:t.power_or_energy(e)),console.log("Pre  assignment net flows are",this._deviceNetFlow.get(o.fromDevice.id),this._deviceNetFlow.get(o.c.target))),this.setConnectionValue(o,r),this._debug&&console.log("Post assignment net flows are",this._deviceNetFlow.get(o.fromDevice.id),this._deviceNetFlow.get(o.c.target)),i+=1}return i}assignDefinedConnections(e){for(const t of this.unassignedConnections){const i=t.c;if(i.entity){const s=e[i.entity];s&&"unavailable"!==s.state&&"unknown"!==s.state&&parseFloat(s.state),this.setConnectionValue(t,parseFloat(s.state))}}}heuristicCompleteAssignments(e){for(const t of this.unassignedConnections){const i=t.fromDevice,s=this._deviceIdMap.get(t.c.target),n=i.power_or_energy(e)-this._deviceNetFlow.get(i.id),o=s.power_or_energy(e)-this._deviceNetFlow.get(s.id);if(n*o>=0)this._debug&&console.log("No flow between",i.id,"and",s.id,"Remaining value on each is",n,o),this.setConnectionValue(t,0);else{const r=Math.min(Math.abs(n),Math.abs(o)),c=n>0?1:-1;this._debug&&console.log("Setting flow between",i.id,"and",s.id,"to",c*r," Remaining values",n,o,"to",n-c*r,o+c*r),this.setConnectionValue(t,c*r),this._debug&&console.log("After assignment, net remaining values are",i.power_or_energy(e)-this._deviceNetFlow.get(i.id),s.power_or_energy(e)-this._deviceNetFlow.get(s.id))}}}copyFlowValues(){for(const e of this._connections)e.c.value=e.value}calculatePowerFlows(e){for(this.reset(),this._debug&&console.log("Have",this._connections.length,"connections to assign"),this.assignDefinedConnections(e),this._debug&&console.log("After assigning defined connections, have",this.unassignedConnections.length,"unassigned connections");this.assignSingletonDevices(e)>0;);if(this._debug&&console.log("After assigning singleton devices, have",this.unassignedConnections.length,"unassigned connections"),this.heuristicCompleteAssignments(e),this._debug){console.log("Final connection assignments:");for(const e of this._connections)console.log(`   from ${e.fromDevice.id} to ${e.c.target}: ${e.value}`);console.log("Final device net flows:");for(const t of this._devices)console.log(`    ${t.id}: ${this._deviceNetFlow.get(t.id)} expected ${t.power_or_energy(e)}`)}this.copyFlowValues()}}class s{constructor(e,t,i){this._inUpdateCycle=!1,this._valueCache={},this._config=e,this._card=t,this._updateSender=i,this._elementID=s.idCounter,s.idCounter+=1,this._elements={needs_reload:!0};for(const t of[...e.power_sink,...e.power_source,...e.energy_sink,...e.energy_source])i.registerUpdateReceiver(t,this);e.percent_entity&&this._updateSender.registerUpdateReceiver(e.percent_entity,this)}get id(){return this._config.id}get connections(){return this._config.connections}updateConfig(e){for(const e of[...this._config.power_sink,...this._config.power_source,...this._config.energy_sink,...this._config.energy_source])this._updateSender.unregisterUpdateReceiver(e,this);for(const t of[...e.power_sink,...e.power_source,...e.energy_sink,...e.energy_source])this._updateSender.registerUpdateReceiver(t,this);this._config.percent_entity&&this._updateSender.unregisterUpdateReceiver(this._config.percent_entity,this),e.percent_entity&&this._updateSender.registerUpdateReceiver(e.percent_entity,this),this._config=e}sumEntities(e,t){var i=0;if(!e||!t)return 0;for(const s of t){const t=e[s];if(t&&"unavailable"!==t.state&&"unknown"!==t.state){const e=t.attributes&&t.attributes.unit_of_measurement?t.attributes.unit_of_measurement:"",s="W"==e||"Wh"==e?.001:1;i+=parseFloat(t.state)*s}}return i}getPower(e){return"power"in this._valueCache||(this._valueCache.power=this.defaultRound(this.sumEntities(e,this._config.power_source)-this.sumEntities(e,this._config.power_sink)),Math.abs(this._valueCache.power)<this._config.floor&&(this._valueCache.power=0)),this._valueCache.power}getEnergyIn(e){return"energyin"in this._valueCache||(this._valueCache.energyin=this.defaultRound(this.sumEntities(e,this._config.energy_sink)),Math.abs(this._valueCache.energyin)<this._config.floor&&(this._valueCache.energyin=0)),this._valueCache.energyin}getEnergyOut(e){return"energyout"in this._valueCache||(this._valueCache.energyout=this.defaultRound(this.sumEntities(e,this._config.energy_source)),Math.abs(this._valueCache.energyout)<this._config.floor&&(this._valueCache.energyout=0)),this._valueCache.energyout}power_or_energy(e){return"power"==this._card.power_or_energy?this.getPower(e):this.getEnergyOut(e)-this.getEnergyIn(e)}defaultRound(e){return Math.round(100*e)/100}getDisplayConfig(e,t,i){let s=this.power_or_energy(t),n=s>0?"-source":s<0?"-sink":"-inactive",o=[];o.push(`display-${i}${n}`),"-source"==n||"-sink"==n?o.push(`display-${i}-active`):o.push(`display-${i}-inactive`),o.push(`display-${i}`),o.push(`display${n}`),"-source"==n||"-sink"==n?o.push("display-active"):o.push("display-inactive"),o.push("display"),"grid"==this._config.id&&console.log("Display config keys to check:",o);for(const e of o)if(e in this._config.display)return this._config.display[e];for(const e of o)if(e in this._card.display)return this._card.display[e];return{color:"black",size:1,circle_radius:-1,hidden:!1}}getHtml(e,t){let i="";const s=this.getDisplayConfig(e,t,"text"),n=this.getDisplayConfig(e,t,"icon");if("power"==e.power_or_energy){const e=this.getPower(t),n=e>=0?"mdi:arrow-bottom-left":"mdi:arrow-top-right";i=`<span class="return text_element_${this._elementID}" style="${this.getStyle(s)}" id="return_${this._elementID}"><ha-icon class="small" icon="${n}"></ha-icon>${Math.abs(e)} kW</span>`}else{const e=this.getEnergyIn(t),s=this.getEnergyOut(t);i=`<span class="return" id="return_${this._elementID}"><ha-icon class="small" icon="mdi:arrow-left"></ha-icon>${e} kWh</span>\n                    <span class="consumption" id="consumption_${this._elementID}"><ha-icon class="small" icon="mdi:arrow-right"></ha-icon>${s} kWh</span>`}let o="",r=this._config.icon;if(this._config.percent_entity&&t[this._config.percent_entity]&&"unavailable"!==t[this._config.percent_entity].state&&"unknown"!==t[this._config.percent_entity].state){let e=Math.round(10*parseFloat(t[this._config.percent_entity].state))/10;if(o=`<div id="percent_${this._elementID}" class="text_element_${this._elementID}" style="${this.getStyle(s)}">${e}%</div><br>`,""==r){let t=10*Math.floor(e/10);t>100&&(t=100),t<10&&(t=10),r=`mdi:battery-${t}`}}return`${o}<ha-icon icon="${r}" style="${this.getStyle(n)}" id="mainicon_${this._elementID}"></ha-icon><br>${i}<br><span style="${this.getStyle(s)}" class="text_element_${this._elementID}">${this._config.name}</span>`}calcAnimationParams(e){const t=Math.abs(e.value)/this._config.max_power;if(0==t)return[0,1e3];const i=Math.min(Math.max(4,10*t),10),s=e.value>0?1:-1;let n=Math.max(1/t,1);return n=Math.min(n,15),n*=s,[i,n]}getStyle(e){return`color: ${e.color}; ${e.hidden?"display: none;":""}`}getPathHtml(e,t,i){this._elements.needs_reload=!0;const s=i.getCoordX(this._config.xPos),n=i.getCoordY(this._config.yPos),o=this.getDisplayConfig(e,t,"circle"),r=o.circle_radius>0?o.circle_radius:this._card.circle_radius,c=`<circle cx="${s}" cy="${n}" r="${r}" fill="white" ${""+(o.hidden?'style="display: none;"':"")} stroke="${o.color}" id="circle_${this._elementID}"/>\n        <foreignObject x="${s-r}" y="${n-r}" width="${2*r}" height="${2*r}">\n            <div xmlns="http://www.w3.org/1999/xhtml" id="cconts_${this._elementID}" class="circle-contents" style="width: ${2*r}px; height: ${2*r}px;">\n                ${this.getHtml(e,t)}\n            </div>\n        </foreignObject>`;let a="",l=1;for(const e of this._config.connections){const t=`line_${this._elementID}_${l}`;l+=1;let[s,n]=this.calcAnimationParams(e);a+=i.getPathSvg(this._config.xPos,this._config.yPos,e.desc,e.color,t,s,n)}return c+a}hassUpdate(e,t){return this._valueCache={},this._hass_states=t,!1}searchElements(e){if(!this._elements.needs_reload)return;this._elements.circleHtml=e.querySelector(`#cconts_${this._elementID}`),this._elements.circles=[],this._elements.animations=[],this._elements.lines=[];let t=1;this._elements.circle=e.querySelector(`#circle_${this._elementID}`);for(const i of this.connections){const i=`#line_${this._elementID}_${t}`;t+=1,this._elements.circles.push(e.querySelector(i+"_circle")),this._elements.animations.push(e.querySelector(i+"_animate")),this._elements.lines.push(e.querySelector(i))}this._elements.needs_reload=!1}incrementalUpdate(e){this.searchElements(e);for(let e=0;e<this.connections.length;e++){const[t,i]=this.calcAnimationParams(this.connections[e]);if(this._elements.circles[e]&&this._elements.circles[e].setAttribute("r",`${t}`),this._elements.animations[e]){let t=i>0?"0;1":"1;0";this._elements.animations[e].setAttribute("dur",`${Math.abs(i)}`),this._elements.animations[e].setAttribute("keyPoints",t),0==this.connections[e].value?this._elements.lines[e].classList.add("pefcm-hidden-line"):this._elements.lines[e].classList.remove("pefcm-hidden-line")}}this._elements.circleHtml.innerHTML=this.getHtml(this._card,this._hass_states);let t=this.getDisplayConfig(this._card,this._hass_states,"circle");const i=""+(t.hidden?"display: none;":"");this._elements.circle.setAttribute("style",i),this._elements.circle.setAttribute("r",`${t.circle_radius>0?t.circle_radius:this._card.circle_radius}`),this._elements.circle.setAttribute("stroke",t.color)}hassUpdateCycleComplete(){return this._inUpdateCycle=!1,!1}}s.idCounter=1;class n{constructor(e){this._xsize=e.maxX+1,this._ysize=e.maxY+1,this._width=e.width,this._height=e.height,this._circle_radius=e.circle_radius}getCoordX(e){return Math.round((e+.5)/this._xsize*this._width*10)/10}getCoordY(e){return Math.round((e+.5)/this._ysize*this._height*10)/10}getNextDeviceCoords(e,t,i){let s=0,n=0;if(i.length<2)return[0,0,0,`Malformed command '${i}'`];const o=i[0],[r,c]=i.substring(1).split(":");"9"!=o&&"6"!=o&&"3"!=o||(s=1),"7"!=o&&"4"!=o&&"1"!=o||(s=-1),"7"!=o&&"8"!=o&&"9"!=o||(n=-1),"1"!=o&&"2"!=o&&"3"!=o||(n=1);return[e+s*parseFloat(r),t+n*parseFloat(r),parseFloat(c),""]}midPointCoord(e,t,i){const[s,n]=e,[o,r]=t;if(s==o)return[s,r>n?r-i:r+i];if(n==r)return[o>s?o-i:o+i,n];const c=o-s,a=r-n,l=i/Math.sqrt(c*c+a*a);return[o-c*l,r-a*l]}curveLineEnd(e,t,i,s){let[n,o]=this.midPointCoord(e,t,s),[r,c]=this.midPointCoord(i,t,s);return` L ${n} ${o} Q ${t[0]} ${t[1]} ${r} ${c}`}getPathSvg(e,t,i,s,n,o,r){if("string"!=typeof i||i.length<2)return"";const c=i.trim().split(/\s+/);let a=e,l=t,d=[];d.push([this.getCoordX(a),this.getCoordY(l)]);for(const e of c){let[t,i,s,n]=this.getNextDeviceCoords(a,l,e);if(n.length>0)return console.log(n),"";a=t,l=i,d.push([this.getCoordX(a),this.getCoordY(l)])}if(d.length<2)return"";let[h,_]=this.midPointCoord(d[1],d[0],this._circle_radius),g=`M ${h} ${_}`;for(let e=0;e<d.length-1;e++)if(e+2<d.length)g+=this.curveLineEnd(d[e],d[e+1],d[e+2],25);else{let[t,i]=this.midPointCoord(d[e],d[e+1],this._circle_radius);g+=` L ${t} ${i}`}let u=r>0?"0;1":"1;0";return`<path id="${n}" ${0==o?'class="pefcm-hidden-line"':""} style="stroke: ${s};" vector-effect="non-scaling-stroke" d="${g}"></path>`+`<circle id="${n}_circle" r="${o}" style="fill: ${s};" class="grid" vector-effect="non-scaling-stroke">\n                <animateMotion id="${n}_animate" repeatCount="indefinite" calcMode="linear" dur="${Math.abs(r)}s" keyPoints="${u}" keyTimes="0;1">\n                    <mpath xlink:href="#${n}"></mpath>\n                </animateMotion>\n            </circle>`}}class o extends HTMLElement{constructor(){super(),this._elements={},this._updateReceivers=new Map,this._entityStateUpdates=new Map,this._needsRerender=!0,this._devices=[],this._cardInnerHtml="",this._resizeObserver=null,this._cardConfig={title:"PEFCM Card",power_or_energy:"power",devices:[],maxX:0,maxY:0,width:200,height:300,circle_radius:40,display:{}},this.doCard(),this.doStyle(),this.doAttach(),this.doQueryElements(),this.doListen()}setConfig(e){this._config=e,this.doCheckConfig(),this.doUpdateConfig()}set hass(e){this._hass=e,this.doUpdateHass()}connectedCallback(){this._resizeObserver=new ResizeObserver(e=>{for(let t of e)this._cardConfig.width=t.contentRect.width,this.forceRerender()}),this._resizeObserver.observe(this)}onClicked(){this.doToggle()}isOff(){return"off"===this.getState().state}isOn(){return"on"===this.getState().state}getHeader(){return this._cardConfig.title}getEntityID(){return this._config.entity}getState(){return this._hass.states[this.getEntityID()]}getAttributes(){return this.getState().attributes}getName(){const e=this.getAttributes().friendly_name;return e||this.getEntityID()}registerUpdateReceiver(e,t){var i;this._updateReceivers.has(e)||(this._updateReceivers.set(e,new Set),this._entityStateUpdates.set(e,"never")),null===(i=this._updateReceivers.get(e))||void 0===i||i.add(t)}unregisterUpdateReceiver(e,t){var i;this._updateReceivers.has(e)&&(null===(i=this._updateReceivers.get(e))||void 0===i||i.delete(t))}doCheckConfig(){const e=new t;this._cardConfig=e.processConfig(this._config)}doCard(){var e;this._cardConfig.height=100*(this._cardConfig.maxY+1);let t=new n(this._cardConfig);this._elements.card||(this._elements.card=document.createElement("ha-card")),this._cardInnerHtml=`<div class="svg-wrapper"><svg class="svg-overlay" viewBox="0 0 ${this._cardConfig.width} ${this._cardConfig.height}" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">`;for(const i of this._devices)this._cardInnerHtml+=i.getPathHtml(this._cardConfig,null===(e=this._hass)||void 0===e?void 0:e.states,t);this._cardInnerHtml+="</svg></div>";var i='<div class="card-content pefcm-content">'+this._cardInnerHtml+"</div>";this._elements.card.innerHTML=i}doStyle(){this._elements.style=document.createElement("style"),this._elements.style.textContent="\n:host {\n    display: block;\n    width: 100%;\n}\n.error {\n        text-color: red;\n    }\n    .error.hidden { display: none; }\n\n    .circle-contents {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        line-height: 0.8;\n     }\n\n  ha-icon.small {\n    --mdc-icon-size: 12px;\n  }\n\n  path {\n    stroke: var(--disabled-text-color);\n    stroke-width: 1;\n    fill: none;\n  }\n  circle.solar,\n  path.solar {\n    stroke: var(--energy-solar-color);\n  }\n  .hidden {\n    display: none;\n  }\n  .pefcm-hidden-line {\n    stroke-width: 0.2 !important;\n    //stroke: transparent !important;\n    //color: gray !important;\n  }\n"}doAttach(){var e;this.attachShadow({mode:"open"}),null===(e=this.shadowRoot)||void 0===e||e.append(this._elements.style,this._elements.card)}doQueryElements(){const e=this._elements.card;this._elements.error=e.querySelector(".error"),this._elements.card_content=e.querySelector(".pefcm-content")}doListen(){this._elements.card.addEventListener("click",this.onClicked.bind(this),!1)}doUpdateConfig(){this._devices=[],this._cardConfig.maxX=0,this._cardConfig.maxY=0;for(const e of this._cardConfig.devices)e.xPos>this._cardConfig.maxX&&(this._cardConfig.maxX=e.xPos),e.yPos>this._cardConfig.maxY&&(this._cardConfig.maxY=e.yPos),this._devices.push(new s(e,this._cardConfig,this));this.getHeader()?this._elements.card.setAttribute("header",this.getHeader()):this._elements.card.removeAttribute("header")}calculatePowerFlows(){new i(this._devices,this._cardConfig.debug).calculatePowerFlows(this._hass.states)}doUpdateHass(){let e=!1;for(const[t,i]of this._updateReceivers){const s=this._hass.states[t],n=this._entityStateUpdates.get(t);if(s&&n!==s.last_updated){this._entityStateUpdates.set(t,s.last_updated);for(const e of i){e.hassUpdate(t,this._hass.states)&&(this._needsRerender=!0)}i.size>0&&(e=!0)}}if(e){if(this.calculatePowerFlows(),this._needsRerender)this._cardConfig.debug&&console.log("Full rerender"),this.forceRerender();else{this._cardConfig.debug&&console.log("Doing incremental redraw");for(const e of this._devices)e.incrementalUpdate(this._elements.card)}for(const e of this._devices)e.hassUpdateCycleComplete()}}forceRerender(){this._needsRerender=!1,this.doCard(),this._elements.card_content.innerHTML=this._cardInnerHtml}doToggle(){}static getStubConfig(){return{type:"custom:power-energy-flow-multi",title:"Household Electricity",devices:[{id:"grid",name:"Grid",icon:"mdi:transmission-tower",xPos:0,yPos:1,power_sink:"sensor.feed_in",power_source:"sensor.grid_consumption",connections:[{desc:62,target:"home",color:"red",mode:"onedirection"}],max_power:15},{id:"battery",name:"Battery",xPos:1,yPos:2,power_source:"sensor.invbatpower",max_power:7,icon:"mdi:battery-30",connections:[{target:"grid",desc:"41 81",color:"cyan"},{target:"home",color:"green",desc:91,mode:"onedirection"}]},{id:"solar",name:"solar",xPos:1,yPos:0,power_source:"sensor.total_solar_power",icon:"mdi:solar-power",connections:[{target:"battery",desc:22,color:"orange",mode:"onedirection"},{target:"grid",desc:"41 21",color:"green",mode:"onedirection"},{target:"home",desc:31,color:"green",mode:"onedirection"}]},{id:"home",xPos:2,yPos:1,power_sink:"sensor.load_power",max_power:10,icon:"mdi:home"}]}}}customElements.define("power-energy-flow-multi",o),window.customCards=window.customCards||[],window.customCards.push({type:"power-energy-flow-multi",name:"Multiple sources power or energy flow card",description:"View energy or power flow for multiple inverters, batteries and sources"})}();
